const ExpressWss = require("../");
const http = require("http");
const WebSocket = require("ws");

(async () => {

	const wss = new WebSocket.Server({ noServer: true });
	wss.on("connection", async (ws) => {
		console.log("wss connection");
	});
	const app = ExpressWss();

	let router = ExpressWss.Router();
	router.use(async (req, {socket, head}, next) => {
		console.log(1)
		next();
	});

	let router2 = ExpressWss.Router();
	router2.wss("/:testId", async (req, {socket, head}) => {
		console.log(2);
		wss.handleUpgrade(req, socket, head, (ws) => {
			wss.emit("connection", wss);
		});
	});
	router.use("/wss-test", router2);

	app.use("/", router);

	const server = http.createServer();
	server.on("upgrade", app);
	server.listen("8888");

})();